// services/PaymentStrategyFactory.ts
import { Request } from 'express';
import Stripe from 'stripe';
import { IPaymentStrategy } from '../interfaces/IPaymentStrategy';
import { CvcTokenPaymentStrategy } from '../strategies/CvcTokenPaymentStrategy';
import { PaymentMethodIdStrategy } from '../strategies/PaymentMethodIdStrategy';
import { ConfirmPaymentIntentStrategy } from '../strategies/ConfirmPaymentIntentStrategy';

export class PaymentStrategyFactory {
  static getStrategy(req: Request, stripe: Stripe): IPaymentStrategy | null {
    const { cvcToken, email, paymentMethodId, paymentIntentId } = req.body;

    if (cvcToken && email) {
      return new CvcTokenPaymentStrategy(stripe);
    } else if (paymentMethodId) {
      return new PaymentMethodIdStrategy(stripe);
    } else if (paymentIntentId) {
      return new ConfirmPaymentIntentStrategy(stripe);
    }

    return null;
  }
}
